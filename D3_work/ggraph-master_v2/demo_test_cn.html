<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
      body,html, svg, #container {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        font-family: verdana;
        overflow: hidden;
        width: 100%;
        height: 100%;
      }

      #controls {
        position:absolute;
        top:0;
        left:0px;
        padding:4px;
        border-bottom: 1px solid #ccc;
        width:100%;
        font-size: 0.7em;
      }

      #controls input {
        font-size:14px
      }

      #controls input[type="button"],
      #controls input[type="submit"] {
        font-size:18px
      }
    </style>
    <link rel="stylesheet" href="src/ggraph.css" />
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="src/marker/marker.js"></script>

    <script src="ext/simmelian.js"></script>
    <script src="ext/singles.js"></script>

    <script src="src/algorithms/ladjust.js"></script>
    <script src="src/algorithms/makecluster.js"></script>

    <script src="src/modules/labels.js"></script>
    <script src="src/modules/groups.js"></script>
    <script src="src/modules/nodes.js"></script>
    <script src="src/modules/selection.js"></script>

    <script src="src/modules/member_lines.js"></script>

    <script src="src/modify/merger.js"></script>
    <script src="src/modify/splitter.js"></script>
    <script src="src/modify/remover.js"></script>

    <script src="src/ggraph.js"></script>
	<script src="http://apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="js/jackwei.slider.js"></script>
    <title>ggraph demo</title>
  </head>
  <body>
    <div id="controls">
      <input type="radio" name="mode" value="select" checked="checked" id="mode-select" onclick="ggraph.set_mode('select')"> <label for="mode-select">Select</label>
      &nbsp;
      <input type="radio" name="mode" value="drag" id="mode-drag" onclick="ggraph.set_mode('drag')"> <label for="mode-drag">Drag</label>
      |
      <input type="button" value="Merge" onclick="merge()" />
      <input type="button" value="Split" onclick="split()" />
      <input type="button" value="Remove" onclick="remove()" />
      | <input type="button" value="Group singles" onclick="_singles()" />
      <input type="button" value="Backbone" onclick="_backbones()" />
      |
      <input type="text" placeholder="Comment..." id="comment" />
      <input type="button" value="Add comment" onclick="_set_comment()" />
      |
      Nodes: <span id="node-count">0</span>
      Edges: <span id="edge-count">0</span>
    </div>
    <div id="container"></div>
	<div id="sliderParent" style="position: fixed; bottom:0;background-color: gray;margin-left:100px">
  </body>
  <script>
        var option = {
        color: 'deepskyblue',
        width: '400px',
        progress: 0.3,
        handleSrc: 'img/slider_handle.png',
        isCustomText: false
    };
	var progress=10;
    $('#sliderParent')
        .jackWeiSlider(option)
        // .setText('2018-4-5 02:39:00')
        .setProgress(0.6)
        .setOnStartDragCallback(function () {
            progress=this.progress;
			
			var all;
    var selected;
    var graph;
    var converted;
    var type = null;

    ggraph.init('container', 25);

    var merge = function() {
      ggraph.merge(selection.all());
    }

    var remove = function() {
      var s = [];
      for (var k in selected) {
        s.push({id: k})
      }
      ggraph.remove(s);
    }

    var split = function() {
      ggraph.split(all);
    }

    function _singles(e) {
      var groups = singles.get_groups(converted);
      all = groups;
      ggraph.merge(groups);
    };

    function _backbones(e) {
      var res = simmelian.filter(converted.all_links, 0.75);
      ggraph.filter_links(res);
    };

    function _set_comment() {
      if (selection.all().length === 0) return;
      var comment = document.getElementById('comment').value;
      var mock = ggraph.convert({
        nodes: [{id: comment, type: 'comment'}],
        links: []
      });

      var original = ggraph.get_graph();
      var comment_obj = mock.nodes[0];

      original.nodes.push(comment_obj);

      for (var key in mock.member_map) {
        original.member_map[key] = mock.member_map[key];
      }

      for (var key in mock.group_map) {
        original.group_map[key] = original.nodes.length - 1;
      }

      document.getElementById('comment').value = '';

      original.all_links[comment] = {}

      var tx = 0;
      var ty = 0;

      selection.all().map(function(selected) {
        var group_id = original.member_map[selected.id].group;
        var target = original.nodes[original.group_map[group_id]];
        tx += target.x;
        ty += target.y;

        original.all_links[comment][selected.id] = 1;
        original.links.push({
          source: comment_obj,
          target: target,
          value: 1
        })
      });

      comment_obj.x = tx / selection.all().length;
      comment_obj.y = ty / selection.all().length;

      ggraph.draw(original);

      selection.clear();
    }

    ggraph.on_select(function(_all, _selected) {
      all = selection.all();
      selected = selection.selected();
    });

    var graph = {
      nodes:[
        {id: "º“À∂", type: "female"},
        {id: "º“À∂1", type: "male"},
        {id: "–ª–ª", type: "male"},
        {id: "–ª–ª1", type: "female"},
        {id: "–ª", type: "male"},
        {id: "–ª∂Ó", type: "female"},
        {id: "–ª∂Ó1", type: "female"},
        {id: "∂Ó1", type: "male"},
        {id: "Verna Bailey", type: "female"},
        {id: "Donni Ballard", type: "female"},
        {id: "Paal Hansen", type: "male"},
        {id: "Shane	Simpson", type: "male"},
        {id: "Robyn Luna", type: "male"},
        {id: "Penny	Marsh", type: "female"},
      ],
      links: [
        {source: "º“À∂", target: "º“À∂1", value:100},
        {source: "º“À∂", target: "–ª–ª"},
        {source: "º“À∂1", target: "–ª–ª"},
        {source: "º“À∂", target: "–ª–ª1"},
        {source: "º“À∂", target: "–ª"},
        {source: "º“À∂1", target: "–ª–ª1"},
        {source: "º“À∂1", target: "–ª"},
        {source: "–ª–ª", target: "–ª–ª1"},
        {source: "–ª–ª", target: "–ª"},
        {source: "–ª–ª1", target: "–ª"},
        {source: "–ª–ª", target: "–ª∂Ó"},
        {source: "–ª∂Ó", target: "–ª∂Ó1"},
        {source: "–ª∂Ó", target: "∂Ó1"},
        {source: "–ª∂Ó1", target: "∂Ó1"},
        {source: "∂Ó1", target: "Verna Bailey"},
        {source: "Donni Ballard", target: "Verna Bailey"},
        {source: "º“À∂", target: "Verna Bailey"},
        {source: "Paal Hansen", target: "Verna Bailey"},

        {source: "Shane	Simpson", target: "Robyn Luna"},
        {source: "Shane	Simpson", target: "Penny	Marsh"},
        {source: "Penny	Marsh", target: "Robyn Luna"}
      ]
    }

    document.getElementById('node-count').innerHTML = graph.nodes.length;
    document.getElementById('edge-count').innerHTML = graph.links.length;

    converted = ggraph.convert(graph);

    ggraph.draw(converted);
        })
        .setOnDragCallback(function (p) {
        })
        .setOnStopDragCallback(function () {
        });
  </script>
</html>
